/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  v2412                                 |
|   \\  /    A nd           | Website:  www.openfoam.com                      |
|    \\/     M anipulation  |                                                 |
-------------------------------------------------------------------------------
Description
    Set the maximum Courant number (maxCo) and ramp it down slightly over time.

\*---------------------------------------------------------------------------*/

maxCo
{
	type		    coded;
    libs            (utilityFunctionObjects);
	name		    nutnu;      
    enabled         true;
    executeControl  timeStep;
    executeInterval 1;

    codeExecute
    #{
        // Get current value and ramp it down a bit
        const scalar& maxCo = mesh.deltaTControls().maxCo();
        scalar newMaxCo = max(0.25, maxCo - 0.001);

        // Log the new value and set it
        Info << "Setting maxCo to: " << newMaxCo << endl;
        mesh.setDeltaTControls(dictionary({{"maxCo", newMaxCo}}));
    #};
}

// ************************************************************************* //
