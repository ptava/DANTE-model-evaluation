#!/bin/sh
cd "${0%/*}" || exit                                # Run from this directory
. ${WM_PROJECT_DIR:?}/bin/tools/RunFunctions        # Tutorial run functions
#------------------------------------------------------------------------------

# Check smoothing argument
if [ -z "$1" ]; then
    echo "No argument supplied. Using default value: False"
    smoothing="false"
else
    smoothing=$1
fi

# Run applications: create grid
runApplication blockMesh
runApplication checkMesh
runApplication topoSet
    
# Check if cfMesh is availabel (we'll use improveMeshQuality utility)
if [ "$smoothing" = "true" ]; then
    if command -v improveMeshQuality >/dev/null 2>&1; then
        runApplication improveMeshQuality -constrainedCellSet protected_cells
    else
        echo "improveMeshQuality command not found. Please install cfMesh"
        echo "integration to use smoothing."
        echo "Skipping smoothing..."
    fi
fi

# Renumbering
restore0Dir
runApplication renumberMesh -overwrite -constant

# Check mesh quality
runApplication -s smoothed checkMesh \
    -allTopology -allGeometry -constant \
    -writeAllFields -writeAllSurfaceFields

#------------------------------------------------------------------------------
